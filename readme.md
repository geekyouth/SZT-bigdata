# SZT-bigdata æ·±åœ³åœ°é“å¤§æ•°æ®å®¢æµåˆ†æç³»ç»Ÿ ğŸš‡ğŸš‡ğŸš‡

```
   ___     ____   _____           _         _      __ _      _             _
  / __|   |_  /  |_   _|   ___   | |__     (_)    / _` |  __| |   __ _    | |_    __ _
  \__ \    / /     | |    |___|  | '_ \    | |    \__, | / _` |  / _` |   |  _|  / _` |
  |___/   /___|   _|_|_   _____  |_.__/   _|_|_   |___/  \__,_|  \__,_|   _\__|  \__,_|
_|"""""|_|"""""|_|"""""|_|     |_|"""""|_|"""""|_|"""""|_|"""""|_|"""""|_|"""""|_|"""""|
"`-0-0-'"`-0-0-'"`-0-0-'"`-0-0-'"`-0-0-'"`-0-0-'"`-0-0-'"`-0-0-'"`-0-0-'"`-0-0-'"`-0-0-'
```

## é¡¹ç›®è¯´æ˜ğŸš©ï¼š
- ğŸˆè¯¥é¡¹ç›®ä¸»è¦åˆ†ææ·±åœ³é€šåˆ·å¡æ•°æ®ï¼Œé€šè¿‡å¤§æ•°æ®æŠ€æœ¯è§’åº¦æ¥ç ”ç©¶æ·±åœ³åœ°é“å®¢è¿èƒ½åŠ›ã€‚
- âœ¨ğŸ‰ å¼ºè°ƒå­¦ä»¥è‡´ç”¨ï¼Œæœ¬é¡¹ç›®çš„åŸåˆ™æ˜¯å°½å¯èƒ½ä½¿ç”¨è¾ƒå¤šçš„å¸¸ç”¨æŠ€æœ¯æ¡†æ¶ï¼ŒåŠ æ·±å¯¹å„æŠ€æœ¯æ ˆçš„ç†è§£å’Œè¿ç”¨ï¼Œåœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­ä½“éªŒå„æ¡†æ¶çš„å·®å¼‚å’Œä¼˜åŠ£ï¼Œä¸ºä»¥åçš„å¼€å‘é¡¹ç›®é€‰å‹åšåŸºç¡€ã€‚
- ğŸ‘‘ è§£å†³åŒä¸€ä¸ªé—®é¢˜ï¼Œå¯èƒ½æœ‰å¤šç§æŠ€æœ¯å®ç°ï¼›å®é™…çš„ä¼ä¸šå¼€å‘åº”å½“éµå®ˆæœ€ä½³å®è·µåŸåˆ™ã€‚


## æ•°æ®æºğŸŒï¼š
- æ·±åœ³å¸‚æ”¿åºœæ•°æ®å¼€æ”¾å¹³å°ï¼Œæ·±åœ³é€šåˆ·å¡æ•°æ® 133.7 ä¸‡æ¡ã€ç¦»çº¿æ•°æ®ã€‘ï¼Œ
https://opendata.sz.gov.cn/data/api/toApiDetails/29200_00403601
    
ç†è®ºä¸Šå¯ä»¥å½“ä½œå®æ—¶æ•°æ®ï¼Œä½†æ˜¯è¿™ä¸ªæ¥å£å“åº”å¤ªæ…¢äº†ï¼Œäºæ˜¯æœ¬é¡¹ç›®é‡‡ç”¨ç¦»çº¿æ€è·¯å¤„ç†ã€‚å½“ç„¶ï¼Œå¦‚æœé‡‡ç”¨ kafka é˜Ÿåˆ—æ–¹å¼ï¼Œä¹Ÿå¯ä»¥æ¨¡æ‹Ÿå‡ºå®æ—¶æ•ˆæœã€‚
    
## æ ¸å¿ƒæŠ€æœ¯æ ˆâš¡ï¼š
- Java/Scala
- Flink-1.10
- Redis-3.2
- SpringBoot-2.13
- knife4j-2.0 ï¼ˆå‰èº«ä¸º swagger-bootstrap-uiï¼‰
- kafka-0.11 (æœ€ä½³ CP kafka-eagle)
- CDH-6.2


## å¿«é€Ÿå¼€å§‹ğŸ›©ğŸ¥‡ï¼š
1- è·å–æ•°æ®æºçš„ appKeyï¼šhttps://opendata.sz.gov.cn/data/api/toApiDetails/29200_00403601

2- è°ƒç”¨ ETL-SpringBoot æ¨¡å—è·å–åŸå§‹æ•°æ®å­˜ç›˜`2018record.jsons`ï¼Œ`cn/java666/etlspringboot/source/SZTData.saveData()`ï¼›

3- è°ƒç”¨ ETL-Flink æ¨¡å—ï¼Œå®ç° etl æ¸…æ´—ï¼Œå»é™¤é‡å¤æ•°æ®ï¼Œredis å¤©ç„¶å»é‡æ’åºï¼Œä¿è¯æ•°æ®å¹²å‡€æœ‰åºï¼Œ`cn.java666.etlflink.sink.RedisSinkPageJson.main()`ã€‚

4- redis æŸ¥è¯¢ï¼Œredis-cli ç™»å½•:  
`> hget szt:pageJson 1`  

æˆ–è€… dbeaver å¯è§†åŒ–æŸ¥è¯¢ï¼š
![](.file/.pic/redis-szt-pageJson.png)

5- `cn.java666.etlspringboot.EtlSApp.main()` å¯åŠ¨åï¼Œä¹Ÿå¯ä»¥ç”¨ knife4j åœ¨çº¿è°ƒè¯• REST APIï¼š
![](.file/.pic/api-1.png)   

![](.file/.pic/api-debug.png)   

6- `cn.java666.etlflink.source.MyRedisSourceFun.run()` æ¸…æ´—æ•°æ®å‘ç° 133.7 ä¸‡æ•°æ®ä¸­ï¼Œæœ‰å°éƒ¨åˆ†å…ƒæ•°æ®å­—æ®µæ•°ä¸º9ï¼Œç¼ºå°‘ä¸¤ä¸ªå­—æ®µï¼šstationã€car_noï¼›ä¸¢å¼ƒè„æ•°æ®ã€‚

åˆæ ¼å…ƒæ•°æ®ç¤ºä¾‹ï¼š
```json
{
    "deal_date": "2018-08-31 21:15:55",
    "close_date": "2018-09-01 00:00:00",
    "card_no": "CBHGDEEJB",
    "deal_value": "0",
    "deal_type": "åœ°é“å…¥ç«™",
    "company_name": "åœ°é“äº”å·çº¿",
    "car_no": "IGT-104",
    "station": "å¸ƒå‰",
    "conn_mark": "0",
    "deal_money": "0",
    "equ_no": "263032104"
}
```
ä¸åˆæ ¼çš„å…ƒæ•°æ®ç¤ºä¾‹ï¼š
```json
{
    "deal_date": "2018-09-01 05:24:22",
    "close_date": "2018-09-01 00:00:00",
    "card_no": "HHAAABGEH",
    "deal_value": "0",
    "deal_type": "åœ°é“å…¥ç«™",
    "company_name": "åœ°é“ä¸€å·çº¿",
    "conn_mark": "0",
    "deal_money": "0",
    "equ_no": "268005140"
}
```
7- æ ¹æ®éœ€æ±‚æ¨é€æ»¡è¶³ä¸šåŠ¡è¦æ±‚çš„å…ƒæ•°æ®åˆ° kafkaï¼š`cn.java666.etlflink.app.Redis2Kafka.main()`ï¼›`topic-flink-szt-all`ä¿ç•™äº†æ‰€æœ‰å…ƒæ•°æ® 1337000 æ¡ï¼Œ `topic-flink-szt` ä»…åŒ…å«æ¸…æ´—åˆæ ¼çš„å…ƒæ•°æ® 1266039 æ¡ã€‚

8- kafka-eagle ç›‘æ§æŸ¥çœ‹ topicï¼š
![](.file/.pic/kafka-eagle02.png)
![](.file/.pic/kafka-eagle01.png)

ksql å‘½ä»¤ï¼š  
`select * from "topic-flink-szt" where "partition" in (0) limit 1000`

![](.file/.pic/ksql.png)

9- `cn.java666.etlflink.app.Redis2Csv.main()` å®ç°äº† flink sink csv æ ¼å¼æ–‡ä»¶ã€‚
![](.file/.pic/csv.png)

10- ...


## TODOğŸ””ğŸ””ğŸ””:
- [x] è§£æ redis pageJsonï¼Œè½¬æ¢æ•°æ®æ ¼å¼ä¸ºæœ€å°æ•°æ®å•å…ƒå­˜åˆ° csvï¼Œå‡å°‘åŸå§‹æ•°æ®çš„å†—ä½™å­—ç¬¦ï¼Œæ–¹ä¾¿å­˜å–å’Œä¼ è¾“ã€‚ä¸°å¯Œæ•°æ®æºçš„æ ¼å¼ï¼Œå…¼å®¹æ›´å¤šçš„å®ç°æ–¹æ¡ˆï¼› 
- [x] æ¨é€ kafkaï¼Œä½¿ç”¨é˜Ÿåˆ—ä¼ è¾“æ•°æ®ï¼›
- [ ] å­˜å…¥ elasticsearchï¼Œä½¿ç”¨å…¨æ–‡æ£€ç´¢å®ç°å®æ—¶æœç´¢ï¼Œkibana å¯è§†åŒ–å±•ç¤ºï¼› 


## æ›´æ–°æ—¥å¿—ğŸŒ¥ï¼š
- 2020-04-14
    - é‡æ„
    - å®Œæˆ csv æ ¼å¼æ–‡ä»¶çš„æŠ½å–ï¼›
    
- 2020-04-13 
    - é¡¹ç›®åˆå§‹åŒ–ï¼›
    - å®Œæˆæ•°æ®æºæ¸…æ´—å»é‡ï¼Œå­˜åˆ° redisï¼›
    - å®Œæˆ redis æŸ¥è¯¢ REST API çš„å¼€å‘ï¼›
    - å®Œæˆ flink è‡ªå®šä¹‰ source redis çš„å¼€å‘ï¼Œå¹¶ä¸”æ›´ç»†ç²’åº¦æ¸…æ´—å…ƒæ•°æ®ï¼›
    - å®Œæˆ æ¨é€å…ƒæ•°æ®åˆ° kafkaï¼›

    